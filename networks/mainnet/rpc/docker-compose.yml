version: "3.4"

services:

  node:
    image: tomochain/node:stable
    logging:
      driver: "json-file"
      options:
        max-file: "5"
        max-size: "10m"
    environment:
      IDENTITY: $IDENTITY
      PRIVATE_KEY: $PRIVATE_KEY
      BOOTNODES: enode://daea23c08fc591109d1478543ed06fc714bd2b380c1eb4bc81e0d0e2ce75d900cfa8010fe127028366c4d8ff5e132246a6268a884152785946c4d13dccf2980e@206.189.18.217:30301
      NETWORK_ID: 88
      VERBOSITY: 3
      NETSTATS_HOST: stats.tomochain.com
      NETSTATS_PORT: 443
      WS_SECRET: getty-site-pablo-auger-room-sos-blair-shin-whiz-delhi
    volumes:
      - $DATA:/tomochain/data/tomo/chaindata
    networks:
      - masternode
    ports:
      - 30303:30303/tcp
      - 30303:30303/udp
    labels:
      - traefik.rpc.backend=rpc
      - traefik.rpc.frontend.rule=Host:rpc.tomochain.com
      - traefik.rpc.docker.network=masternode
      - traefik.rpc.port=7050
      - traefik.ws.backend=websocket
      - traefik.ws.frontend.rule=Host:ws.tomochain.com
      - traefik.ws.docker.network=masternode
      - traefik.ws.port=8050
      - traefik.ws.loadbalancer.stickiness=true
    restart: always

  proxy:
    image: traefik:alpine
    environment:
      CF_API_EMAIL: $CLOUDFLARE_EMAIL
      CF_API_KEY: $CLOUDFLARE_API_KEY
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:rw
      - ./acme.json:/acme.json:rw
      - ./traefik.toml:/traefik.toml:ro
    logging:
      driver: "json-file"
      options:
        max-file: "5"
        max-size: "10m"
    networks:
      - masternode
    ports:
      - 80:80
      - 443:443
    labels:
      - traefik.enable=false

networks:
  masternode:
